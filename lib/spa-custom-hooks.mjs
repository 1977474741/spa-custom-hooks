function t(t,e){var o=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),o.push.apply(o,n)}return o}function e(e){for(var o=1;o<arguments.length;o++){var n=null!=arguments[o]?arguments[o]:{};o%2?t(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):t(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,u(n.key),n)}}function i(t,e,o){return e&&n(t.prototype,e),o&&n(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t}function r(t,e,o){return(e=u(e))in t?Object.defineProperty(t,e,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[e]=o,t}function a(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var o=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=o){var n,i,r,a,c=[],s=!0,u=!1;try{if(r=(o=o.call(t)).next,0===e){if(Object(o)!==o)return;s=!1}else for(;!(s=(n=r.call(o)).done)&&(c.push(n.value),c.length!==e);s=!0);}catch(t){u=!0,i=t}finally{try{if(!s&&null!=o.return&&(a=o.return(),Object(a)!==a))return}finally{if(u)throw i}}return c}}(t,e)||c(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c(t,e){if(t){if("string"==typeof t)return s(t,e);var o=Object.prototype.toString.call(t).slice(8,-1);return"Object"===o&&t.constructor&&(o=t.constructor.name),"Map"===o||"Set"===o?Array.from(t):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?s(t,e):void 0}}function s(t,e){(null==e||e>t.length)&&(e=t.length);for(var o=0,n=new Array(e);o<e;o++)n[o]=t[o];return n}function u(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var o=t[Symbol.toPrimitive];if(void 0!==o){var n=o.call(t,e||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}var h,l,f=function(t,e,o){try{if(e){var n=e;"string"==typeof e&&(n=e.split("."));for(var i=o?n.length-1:n.length,r=0;r<i;r++)t=t[n[r]];return o?{key:n[i],obj:t}:t}return t}catch(t){return}},m=function(t){return h&&h.state?h:t&&t.$store||{}},p=function(){function t(e){var n=e.customhook,i=e.name,r=e.destroy,a=e.hit,c=void 0!==a&&a,s=e.watchKey,u=e.onUpdate,h=e.type,l=e.weightValue;o(this,t),this.name=i,this.destroy=r,this.type=h,this.hit=c,this.watchKey=s,this.weightValue=l,this.initFlag=!1,this.onUpdate=u,this.__customhook=n}return i(t,[{key:"init",value:function(){var t=this;this.initFlag||(this.watchKey&&(this.unwatchFn=this.watchAttr((function(e){t[e?"cycleStart":"cycleEnd"]()}))),this.initFlag=!0)}},{key:"cycleStart",value:function(){this.hit||(this.hit=!0,this.__customhook&&this.__customhook.triggerHook(this.name))}},{key:"cycleEnd",value:function(){this.hit&&(this.hit=!1,this.__customhook&&this.__customhook.resetExecute(this.destroy))}},{key:"watchAttr",value:function(t){try{var e=this;return m(this.__customhook.instance).watch((function(t){return f(t,e.watchKey)}),(function(o,n){t(e.onUpdate?e.onUpdate(o,n):o)}),{watchKey:e.watchKey})}catch(t){}}}]),t}(),d={},y=["created","attached","ready","detached"],k=["show","hide","routeDone"],g=function(t){if(Array.isArray(t))return s(t)}(l=new Set([].concat(["beforeCreate","created","onPageShow","beforeMount","mounted","activated","onPageHide","deactivated","beforeDestroy","destroyed","onLaunch","onLoad","onShow","onReady","onHide","onUnload"],["onInit","created","attached","ready","didMount","detached","didUnmount"])))||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(l)||c(l)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),v=function(t,o){return Object.keys(d).reduce((function(e,o){var n=d[o];return n.customhook=t,(e[o]=new p(n))&&e}),e({BeforeCreate:new p({customhook:t,name:"BeforeCreate",destroy:"destroyed",hit:!0,weightValue:2}),BeforeMount:new p({customhook:t,name:"beforeMount",destroy:"destroyed",weightValue:4}),PageShow:new p({customhook:t,name:"onPageShow",destroy:"onPageHide",weightValue:4.1}),Mounted:new p({customhook:t,name:"mounted",destroy:"destroyed",weightValue:5}),Activated:new p({customhook:t,name:"activated",destroy:"deactivated",weightValue:6}),PageHide:new p({customhook:t,name:"onPageHide",destroy:"onPageShow",weightValue:6.1}),Deactivated:new p({customhook:t,name:"deactivated",destroy:"activated",weightValue:7})},t.isComponent?{Init:new p({customhook:t,name:"onInit",destroy:"didUnmount",hit:"onInit"===o,weightValue:2}),Created:new p({customhook:t,name:"created",destroy:"detached",hit:"created"===o,weightValue:3}),Attached:new p({customhook:t,name:"attached",destroy:"detached",weightValue:4}),Show:new p({customhook:t,name:"show",destroy:"hide",weightValue:5}),Ready:new p({customhook:t,name:"ready",destroy:"detached",weightValue:6}),RouteDone:new p({customhook:t,name:"routeDone",destroy:"detached",weightValue:7}),Hide:new p({customhook:t,name:"hide",destroy:"show",weightValue:8}),Detached:new p({customhook:t,name:"detached",destroy:"attached",weightValue:9}),DidMount:new p({customhook:t,name:"didMount",destroy:"didUnmount",hit:"didMount"===o,weightValue:10})}:{Launch:new p({customhook:t,name:"onLaunch",destroy:"onUnload",hit:!0,weightValue:3}),Created:new p({customhook:t,name:"created",destroy:"destroyed",hit:"created"===o,weightValue:3}),Load:new p({customhook:t,name:"onLoad",destroy:"onUnload",hit:"onLoad"===o,weightValue:4}),Ready:new p({customhook:t,name:"onReady",destroy:"onUnload",weightValue:5}),Show:new p({customhook:t,name:"onShow",destroy:"onHide",weightValue:6}),Hide:new p({customhook:t,name:"onHide",destroy:"onShow",weightValue:7})}))},w=function(){function t(e){var n=e.instance,i=e.options,r=e.pageHooks,a=e.instanceType,c=e.initHookName;o(this,t),this.instance=n,this.instanceType=a,this.initHookName=c,this.isComponent="component"===a,this.customHooks={},this.customHookArr=[],this.hook={},this.options=i||{},this.pageHooks=r,this.diyHooks=Object.keys(d),this.init(),this.triggerHook()}return i(t,[{key:"init",value:function(){var t=this,e=v(this,this.initHookName);this.presetHooksName=Object.keys(e),this.hook=e;var o=this.pageHooks,n=o.hasOwnProperty("beforeCreate")||o.hasOwnProperty("onReady");o=n?o:o.__proto__,this.isComponent&&Object.assign(o,o.lifetimes,o.pageLifetimes);var i=this.filterHooks(o),r=i.customHookArr,a=i.hookInscape;r.forEach((function(e){t.customHooks[e]={callback:o[e].bind(t.instance),inscape:a[e],execute:!1,weightValue:a[e].reduce((function(e,o){var n;return e+((null===(n=t.hook[o])||void 0===n?void 0:n.weightValue)||0)}),0)}})),this.customHookArr=r.sort((function(e,o){return t.customHooks[e].weightValue-t.customHooks[o].weightValue})),Object.keys(this.hook).forEach((function(e){return t.hook[e].init()}))}},{key:"filterHooks",value:function(t){var e=this,o={},n={},i=Object.keys(t).filter((function(t){var i=e.getHookArr(t);return!!i.length&&(o[t]=i.filter((function(o){return e.hook[o]?(n[o]=e.hook[o],!0):(console.warn('[custom-hook 错误声明警告] "'.concat(o,'"钩子未注册，意味着"').concat(t,'"可能永远不会执行，请先注册此钩子再使用，文档：https://github.com/1977474741/spa-custom-hooks#-diyhooks对象说明')),!1)})),t=="on"+i.join("")&&o[t].length==i.length)}));return this.hook=n,{customHookArr:i,hookInscape:o}}},{key:"triggerHook",value:function(t){var e=this;this.customHookArr.forEach((function(t){var o=e.customHooks[t];o.inscape.every((function(t){return e.hook[t]&&e.checkHookHit(e.hook[t])}))&&!o.execute&&(o.execute=!0,e.customHooks[t].callback(e.options))}))}},{key:"resetExecute",value:function(t){var e=this;this.customHookArr.forEach((function(o){var n=e.customHooks[o];n.inscape.find((function(o){var n;return t===(null===(n=e.hook[o])||void 0===n?void 0:n.destroy)}))&&(n.execute=!1)}))}},{key:"checkHookHit",value:function(t){if(t.watchKey){var e=f(m(t.__customhook.instance).state,t.watchKey);return t.onUpdate?t.onUpdate(e):e}return t.hit}},{key:"getHookArr",value:function(t){if(-1==t.indexOf("on"))return[];var e=this.splitHook(t),o=this.diyHooks;return e.length>1||-1!=o.indexOf(e[0])?e:[]}},{key:"splitHook",value:function(t){var e=this;t=t.replace("on",""),this.presetHooksName.sort((function(t,e){return e.length-t.length}));var o=new RegExp("("+this.presetHooksName.join("|")+")","g");return t.split(o).filter((function(t){return e.hook[t]}))}}]),t}(),b={"vue-h5":{hooksKey:"$options",initHook:"beforeCreate",supportComponent:!0,isPage(t){return t._compiled&&this.supportComponent}},"vue-miniprogram":{hooksKey:"$options",initHook:"beforeCreate",supportComponent:!0,isPage(){return this.supportComponent}},miniprogram:{name:"miniprogram",hooksKey:"",initHook:"onLoad",initHookApp:"onLaunch",initHookComponentAlipay:"didMount",initHookComponentAlipayInit:"onInit",initHookComponentWx:"created",initHookComponentLifetimes:"created",supportComponent:!0,isPage(){return this.supportComponent}}},H=b["vue-miniprogram"],j=function(t,o,n,i){function r(t,e,o){if(this.customHook){var n=this.customHook.hook,i=Object.keys(n).find((function(t){return n[t].name===o}));if(!n[i].hit)return void s.call(this,e,o)}a.call(this,e,"component",t,o)}function a(t,e,o,r){if(!this.customHook){var a=f(this,H.hooksKey);if(H.isPage(a)){!n.state&&i&&(n.state=this[i]||i);var c="component"===e;Object.defineProperty(this,"customHook",{value:new w({instance:this,options:t,pageHooks:c?o:a,instanceType:e,initHookName:r}),configurable:!0,enumerable:!1})}}}function c(t){return t.reduce((function(t,e){return(t[e]=function(t){s.call(this,t,e)})&&t}),{})}function s(t,e){if(("object"==typeof this.customHook||null==typeof this.customHook)&&this.customHook.customHookArr.length){t&&Object.keys(t).length>0&&(this.customHook.options=t);var o=this.customHook.hook,n=["beforeDestroy","destroyed","onUnload"].includes(e);for(var i in o){var r=o[i];r.name==e?r.cycleStart():r.destroy==e&&r.cycleEnd(),n&&r.unwatchFn&&r.unwatchFn()}n&&delete this.customHook}}t.mpvueVersion?H.initHook="onLoad":t.userAgentKey&&(H=b[t.userAgentKey]),h=n,d=o,t.mixin(e(e({},c(g)),{},{[H.initHook](t){a.call(this,t,"page",void 0,H.initHook)}},"miniprogram"===H.name?{[H.initHookApp](t){a.call(this,t,"app",void 0,H.initHookApp)},[H.initHookComponentWx](t,e){a.call(this,e,"component",t,H.initHookComponentWx)},[H.initHookComponentAlipayInit](t,e){a.call(this,e,"component",t,H.initHookComponentAlipayInit)},[H.initHookComponentAlipay](t,e){r.call(this,t,e,H.initHookComponentAlipay)},lifetimes:e(e({},c(y)),{},{[H.initHookComponentLifetimes](t,e){r.call(this,t,e,H.initHookComponentLifetimes)}}),pageLifetimes:e({},c(k))}:{}))},A=Object.freeze({__proto__:null,get BASE(){return H},install:j}),O={mixin(t){var e=this,o=App,n=Page,i=Component;App=function(n){e.mergeHook(t,n),o(n)},Page=function(o){e.mergeHook(t,o),n(o)},Component=function(o){e.mergeComponentHook(t,o);var n=e.mixinLifetimes(t,o);i(n)}},mergeHook(t,e){for(var o=function(){var t=a(i[n],2),o=t[0],r=t[1],c=e[o];e[o]=function(){for(var t=arguments.length,e=new Array(t),o=0;o<t;o++)e[o]=arguments[o];c&&c.call.apply(c,[this].concat(e)),r.call.apply(r,[this].concat(e))}},n=0,i=Object.entries(t);n<i.length;n++)o()},mergeComponentHook(t,e){var o,n=["lifetimes","pageLifetimes"],i=function(t,e){var o="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!o){if(Array.isArray(t)||(o=c(t))||e&&t&&"number"==typeof t.length){o&&(t=o);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,a=!0,s=!1;return{s:function(){o=o.call(t)},n:function(){var t=o.next();return a=t.done,t},e:function(t){s=!0,r=t},f:function(){try{a||null==o.return||o.return()}finally{if(s)throw r}}}}(Object.entries(t).filter((function(t){return!n.includes(t[0])})));try{var r=function(){var t=a(o.value,2),n=t[0],i=t[1],r=e[n];e[n]=function(){for(var t=arguments.length,o=new Array(t),n=0;n<t;n++)o[n]=arguments[n];r&&r.call.apply(r,[this].concat(o)),i.call.apply(i,[this,e].concat(o))}};for(i.s();!(o=i.n()).done;)r()}catch(t){i.e(t)}finally{i.f()}},mixinLifetimes(t,e){if("function"==typeof Behavior){var o=e.behaviors||[],n=t.lifetimes.created;return t.lifetimes.created=function(){for(var t=arguments.length,o=new Array(t),i=0;i<t;i++)o[i]=arguments[i];n&&n.call.apply(n,[this,e].concat(o))},o.push(Behavior({lifetimes:t.lifetimes,pageLifetimes:t.pageLifetimes})),e.behaviors=o,e}var i=e.mixins||[];if(e.options&&e.options.lifetimes){var r=t.lifetimes.created;t.lifetimes.created=function(){for(var t=arguments.length,o=new Array(t),n=0;n<t;n++)o[n]=arguments[n];r&&r.call.apply(r,[this,e].concat(o))}}return i.push(Mixin({lifetimes:t.lifetimes,pageLifetimes:t.pageLifetimes,options:{lifetimes:!0}})),e.mixins=i,e},userAgentKey:"miniprogram"},C={},P={watch(t,e,o){var n=m().state,i=o.watchKey,r=f(n,i,!0),c={callback:e,unwatch:!1};C[i]?C[i].push(c):C[i]=[c];var s=[];return function t(o,n){var c=o[n];Object.defineProperty(o,n,{configurable:!0,enumerable:!0,set:function(t){c=t,C[i].map((function(t){return t.callback(r.obj[r.key])}))},get:function(){return c}}),Array.isArray(o[n])&&s.push((u=o[n],h=function(){e(r.obj[r.key])},l=Object.create(u),f=["push","pop","shift","unshift","splice","sort","reverse"].map((function(t){var e=l[t];return S(u,t,(function(){return e.apply(this,arguments),h.apply(this,arguments)})),function(){S(u,t,e)}})),function(){f.map((function(t){return t()}))}));var u,h,l,f;if("object"==typeof o[n]&&null!=o[n])for(var m=0,p=Object.entries(o[n]);m<p.length;m++){var d=a(p[m],2),y=d[0];d[1],t(o[n],y)}}(r.obj,r.key),function(){c.unwatch=!0;var t=C[i].findIndex((function(t){return t.unwatch}));C[i].splice(t,1),C[i].length||delete C[i],s.map((function(t){return t()}))}}};function S(t,e,o,n){Object.defineProperty(t,e,{value:o,enumerable:!!n,writable:!0,configurable:!0})}var V={install:function(){arguments.length<3?j(O,arguments[0],P,arguments[1]||"globalData"):j.apply(A,arguments)},setHit:function(t,e){v()[t][e?"cycleStart":"cycleEnd"]()}};export{V as default};
