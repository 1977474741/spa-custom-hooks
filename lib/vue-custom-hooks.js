!function(t,o){"object"==typeof exports&&"undefined"!=typeof module?module.exports=o():"function"==typeof define&&define.amd?define(o):(t="undefined"!=typeof globalThis?globalThis:t||self)["vue-custom-hooks"]=o()}(this,function(){"use strict";function n(o,t){var e=Object.keys(o);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(o);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(o,t).enumerable})),e.push.apply(e,n)}return e}function r(o){for(var t=1;t<arguments.length;t++){var e=null!=arguments[t]?arguments[t]:{};t%2?n(Object(e),!0).forEach(function(t){s(o,t,e[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(e)):n(Object(e)).forEach(function(t){Object.defineProperty(o,t,Object.getOwnPropertyDescriptor(e,t))})}return o}function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function a(t,o){if(!(t instanceof o))throw new TypeError("Cannot call a class as a function")}function c(t,o){for(var e=0;e<o.length;e++){var n=o[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function t(t,o,e){return o&&c(t.prototype,o),e&&c(t,e),t}function s(t,o,e){return o in t?Object.defineProperty(t,o,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[o]=e,t}function u(t){return function(t){if(Array.isArray(t))return h(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,o){if(!t)return;if("string"==typeof t)return h(t,o);var e=Object.prototype.toString.call(t).slice(8,-1);"Object"===e&&t.constructor&&(e=t.constructor.name);if("Map"===e||"Set"===e)return Array.from(t);if("Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return h(t,o)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function h(t,o){(null==o||o>t.length)&&(o=t.length);for(var e=0,n=new Array(o);e<o;e++)n[e]=t[e];return n}var f,l=function(t,o){try{return o.split(".").reduce(function(t,o){return t[o]},t)}catch(t){return}},p=function(t){return f&&f.state?f:t&&t.$store||{}},y=function(){function u(t){var o=t.customhook,e=t.name,n=t.destroy,r=t.hit,i=void 0!==r&&r,c=t.watchKey,s=t.onUpdate;a(this,u),this.name=e,this.destroy=n,this.hit=i,this.need=!1,this.initFlag=!1,c&&(this.watchKey=c.replace("$store.state.","")),this.onUpdate=s,this.__customhook=o}return t(u,[{key:"init",value:function(){var o=this;this.initFlag||(this.watchKey&&this.watchAttr(function(t){o[t?"cycleStart":"cycleEnd"]()}),this.initFlag=!0)}},{key:"cycleStart",value:function(){this.hit||(this.hit=!0,this.__customhook&&this.__customhook.triggerHook(this.name))}},{key:"cycleEnd",value:function(){this.hit&&(this.hit=!1,this.__customhook&&this.__customhook.resetExecute(this.name))}},{key:"watchAttr",value:function(e){try{var n=this;p(this.__customhook.pageInstance).watch(function(t){return l(t,n.watchKey)},function(t,o){e(n.onUpdate?n.onUpdate(t,o):t)})}catch(t){}}}]),u}(),d={},m=["created","beforeMount","mounted","activated","deactivated","beforeDestroy","destroyed","onLoad","attached","detached","onShow","onHide","onReady","onUnload"],k=function(n){return r({Launch:new y({customhook:n,name:"onLaunch",destroy:"onUnload",hit:!0}),Created:new y({customhook:n,name:"created",destroy:"destroyed",hit:!0}),Load:new y({customhook:n,name:"onLoad",destroy:"onUnload",hit:"onLoad"==w.initHook}),Attached:new y({customhook:n,name:"attached",destroy:"detached"}),Show:new y({customhook:n,name:"onShow",destroy:"onHide"}),Mounted:new y({customhook:n,name:"mounted",destroy:"destroyed"}),Ready:new y({customhook:n,name:"onReady",destroy:"onUnload"})},Object.keys(d).reduce(function(t,o){var e=d[o];return e.customhook=n,(t[o]=new y(e))&&t},{}))},b=function(){return Object.keys(d)},g=m.map(function(t){return o(t)}),v=function(){function n(t,o,e){a(this,n),this.pageInstance=t,this.customHooks={},this.customHookArr=[],this.hook={},this.options=o,this.pageHooks=e,this.init()}return t(n,[{key:"init",value:function(){var o=this,e=k(this);this.hook=e;var n=this.pageHooks,t=n.hasOwnProperty("created")||n.hasOwnProperty("onLoad"),r=this.filterHooks(t?n:n.__proto__),i=r.customHookArr,c=r.hookInscape;(this.customHookArr=i).forEach(function(t){o.customHooks[t]={callback:n[t].bind(o.pageInstance),inscape:c[t],execute:!1},c[t].forEach(function(t){return e[t].need=!0})}),i.length&&Object.keys(e).forEach(function(t){return e[t].need&&e[t].init()})}},{key:"filterHooks",value:function(t){var e=this,n={};return{customHookArr:Object.keys(t).filter(function(o){var t=e.getHookArr(o);return!!t.length&&(n[o]=t.filter(function(t){return!!e.hook[t]||(console.warn('[custom-hook 错误声明警告] "'.concat(t,'"钩子未注册，意味着"').concat(o,'"可能永远不会执行，请先注册此钩子再使用，文档：https://github.com/1977474741/vue-custom-hooks#-diyhooks对象说明')),!1)}),o=="on"+t.join("")&&n[o].length==t.length)}),hookInscape:n}}},{key:"triggerHook",value:function(t){var e=this;this.pageInstance.$mp&&console.log(this.pageInstance.$mp.appOptions),this.customHookArr.forEach(function(t){var o=e.customHooks[t];o.inscape.every(function(t){return e.hook[t].need&&e.checkHookHit(e.hook[t])})&&!o.execute&&(e.customHooks[t].callback(e.options),o.execute=!0)})}},{key:"resetExecute",value:function(e){var n=this;e=o(e),this.customHookArr.forEach(function(t){var o=n.customHooks[t];-1!=o.inscape.indexOf(e)&&(o.execute=!1)})}},{key:"splitHook",value:function(t){t=t.replace("on","").split(/(?=[A-Z])/);for(var o=u(new Set(g.concat(b()))).sort(function(t,o){return o.length-t.length}),e=[],n="",r=0;r<t.length;r++){n+=t[r],-1!=o.indexOf(n)&&(e.push(n),n="")}return e}},{key:"checkHookHit",value:function(t){if(t.watchKey){var o=l(p(t.__customhook.pageInstance).state,t.watchKey);return t.onUpdate?t.onUpdate(o):o}return t.hit}},{key:"getHookArr",value:function(t){if(-1==t.indexOf("on"))return[];var o=this.splitHook(t),e=b();return 1<o.length||-1!=e.indexOf(o[0])?o:[]}}]),n}();function o(t){return t=(t=t.replace("on","")).substring(0,1).toUpperCase()+t.substring(1)}var w,H={h5:{hooksKey:"$options",initHook:"created",supportComponent:!0,isPage:function(t){return t._compiled&&this.supportComponent}},miniprogram:{hooksKey:"$options",initHook:"created",supportComponent:!0,isPage:function(){return this.supportComponent}}};try{wx.version.features&&wx.env,w=H.miniprogram}catch(t){w=H.h5}return{install:function(t,o,e){t.mpvueVersion&&(H.miniprogram.initHook="onLoad"),f=e,d=o,t.mixin(r(r({},m.reduce(function(t,r){return t[r]=function(t){if(("object"==i(this.customHook)||null==typeof this.customHook)&&this.customHook.customHookArr.length){t&&(this.customHook.options=t);var o=this.customHook.hook;for(var e in o){var n=o[e];n.name==r?n.cycleStart():n.destroy==r&&n.cycleEnd()}}},t},{})),{},s({},w.initHook,function(t){var o=l(this,w.hooksKey);w.isPage(o)&&(this.customHook=new v(this,t,o))})))},setHit:function(t,o){k()[t][o?"cycleStart":"cycleEnd"]()}}});
