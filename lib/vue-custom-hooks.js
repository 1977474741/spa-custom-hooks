!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self)["vue-custom-hooks"]=e()}(this,function(){"use strict";function n(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),o.push.apply(o,n)}return o}function o(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?n(Object(o),!0).forEach(function(t){c(e,t,o[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):n(Object(o)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))})}return e}function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function t(t,e,o){return e&&r(t.prototype,e),o&&r(t,o),t}function c(t,e,o){return e in t?Object.defineProperty(t,e,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[e]=o,t}function a(t){return function(t){if(Array.isArray(t))return u(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return u(t,e);var o=Object.prototype.toString.call(t).slice(8,-1);"Object"===o&&t.constructor&&(o=t.constructor.name);if("Map"===o||"Set"===o)return Array.from(t);if("Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return u(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function u(t,e){(null==e||e>t.length)&&(e=t.length);for(var o=0,n=new Array(e);o<e;o++)n[o]=t[o];return n}var h=function(){function u(t){var e=t.customhook,o=t.name,n=t.destroy,r=t.hit,i=void 0!==r&&r,c=t.watchKey,a=t.onUpdate;s(this,u),this.name=o,this.destroy=n,this.hit=i,this.need=!1,this.initFlag=!1,this.watchKey=c,this.onUpdate=a,this.__customhook=e}return t(u,[{key:"init",value:function(){var e=this;this.initFlag||(this.watchKey&&this.watchAttr(function(t){e[t?"cycleStart":"cycleEnd"]()}),this.initFlag=!0)}},{key:"cycleStart",value:function(){this.hit||(this.hit=!0,this.__customhook.triggerHook())}},{key:"cycleEnd",value:function(){this.hit&&(this.hit=!1,this.__customhook.resetExecute(this.name))}},{key:"watchAttr",value:function(o){var n=this;this.__customhook.pageInstance.$watch(this.watchKey,{immediate:!1,handler:function(t,e){o(n.onUpdate?n.onUpdate(t,e):t)}})}}]),u}(),f={},p=["created","beforeMount","mounted","activated","deactivated","beforeDestroy","destroyed","onLoad","attached","detached","onShow","onHide","onReady","onUnload"],y=function(){return Object.keys(f)},d=p.map(function(t){return m(t)}),l=function(){function n(t,e,o){s(this,n),this.pageInstance=t,this.hookFun={},this.hooksStr=[],this.hook={},this.options=e,this.pageHooks=o,this.init()}return t(n,[{key:"init",value:function(){var n,r=this,i=o({Launch:new h({customhook:n=this,name:"onLaunch",destroy:"onUnload",hit:!0}),Created:new h({customhook:n,name:"created",destroy:"destroyed",hit:!0}),Load:new h({customhook:n,name:"onLoad",destroy:"onUnload",hit:"onLoad"==v.BASE.initHook}),Attached:new h({customhook:n,name:"attached",destroy:"detached"}),Show:new h({customhook:n,name:"onShow",destroy:"onHide"}),Mounted:new h({customhook:n,name:"mounted",destroy:"destroyed"}),Ready:new h({customhook:n,name:"onReady",destroy:"onUnload"})},Object.keys(f).reduce(function(t,e){var o=f[e];return o.customhook=n,(t[e]=new h(o))&&t},{}));this.hook=i;var c={};Object.keys(this.pageHooks).filter(function(e){return!!y().some(function(t){return-1!=e.indexOf(t)&&-1==p.indexOf("on"+t)})&&(c[e]=r.splitHook(e),e=="on"+c[e].join("")&&c[e].every(function(t){return i[t]}))}).forEach(function(t,o){r.hooksStr[o]={name:[],execute:!1},r.hookFun[t]=r.pageHooks[t],c[t].forEach(function(t){if(i[t]&&i[t].init)if(r.hooksStr[o].name.push(t),i[t].destroy&&i[t].name){var e=r.pageHooks;e[i[t].name].length&&e[i[t].destroy].length&&(i[t].need=!0)}else i[t].need=!0})}),Object.keys(i).forEach(function(t){return i[t].need&&i[t].init()})}},{key:"triggerHook",value:function(t){var e=this;this.hooksStr.forEach(function(t){t.name.every(function(t){return e.hook[t].need&&e.checkHookHit(e.hook[t])})&&!t.execute&&(e.hookFun["on"+t.name.join("")].call(e.pageInstance,e.options),t.execute=!0)})}},{key:"resetExecute",value:function(e){e=m(e),this.hooksStr.forEach(function(t){-1!=t.name.indexOf(e)&&(t.execute=!1)})}},{key:"splitHook",value:function(t){t=t.replace("on","").split(/(?=[A-Z])/);for(var e=a(new Set(d.concat(y()))).sort(function(t,e){return e.length-t.length}),o=[],n="",r=0;r<t.length;r++){n+=t[r],-1!=e.indexOf(n)&&(o.push(n),n="")}return o}},{key:"checkHookHit",value:function(t){if(t.watchKey){var e=(o=t.__customhook.pageInstance,t.watchKey.split(".").reduce(function(t,e){return t[e]},o));return t.onUpdate?t.onUpdate(e):e}return t.hit;var o}}]),n}();function m(t){return t=(t=t.replace("on","")).substring(0,1).toUpperCase()+t.substring(1)}var e={h5:{hooksKey:"$options.__proto__",mainHooksKey:"$options",initHook:"created",supportComponent:!0,isPage:function(t,e){return t._compiled&&(this.supportComponent||"page"==e||"app"==e)}},wx:{hooksKey:"$options",mainHooksKey:"$options",initHook:"created",supportComponent:!0,isPage:function(t,e){return this.supportComponent||"page"==e||"app"==e}}};try{uni.x}catch(t){e.wx.initHook="onLoad"}var k=e[document?"h5":"wx"],b=function(t,e){return e.split(".").reduce(function(t,e){return t[e]},t)},v={install:function(t,e){f=e,t.mixin(o(o({},p.reduce(function(t,r){return t[r]=function(t){if("object"==i(this.customHook)){t&&(this.customHook.options=t);var e=this.customHook.hook;for(var o in e){var n=e[o];n.name==r?n.cycleStart():n.destroy==r&&n.cycleEnd()}}},t},{})),{},c({},k.initHook,function(t){var e=b(this,k["app"==this.$options.mpType?"mainHooksKey":"hooksKey"]),o=this.$mp&&this.$mp.mpType||e.mpType;k.isPage(e,o)&&(this.customHook=new l(this,t,e))})))},BASE:k};return v});
