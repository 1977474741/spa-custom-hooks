!function(t,o){"object"==typeof exports&&"undefined"!=typeof module?module.exports=o():"function"==typeof define&&define.amd?define(o):(t="undefined"!=typeof globalThis?globalThis:t||self)["vue-custom-hooks"]=o()}(this,(function(){"use strict";function t(t,o){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);o&&(n=n.filter((function(o){return Object.getOwnPropertyDescriptor(t,o).enumerable}))),e.push.apply(e,n)}return e}function o(o){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?t(Object(n),!0).forEach((function(t){c(o,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(n)):t(Object(n)).forEach((function(t){Object.defineProperty(o,t,Object.getOwnPropertyDescriptor(n,t))}))}return o}function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function n(t,o){if(!(t instanceof o))throw new TypeError("Cannot call a class as a function")}function r(t,o){for(var e=0;e<o.length;e++){var n=o[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function i(t,o,e){return o&&r(t.prototype,o),e&&r(t,e),t}function c(t,o,e){return o in t?Object.defineProperty(t,o,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[o]=e,t}function u(t){return function(t){if(Array.isArray(t))return s(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,o){if(!t)return;if("string"==typeof t)return s(t,o);var e=Object.prototype.toString.call(t).slice(8,-1);"Object"===e&&t.constructor&&(e=t.constructor.name);if("Map"===e||"Set"===e)return Array.from(t);if("Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return s(t,o)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(t,o){(null==o||o>t.length)&&(o=t.length);for(var e=0,n=new Array(o);e<o;e++)n[e]=t[e];return n}var a,h=function(t,o){try{return o.split(".").reduce((function(t,o){return t[o]}),t)}catch(t){return}},f=function(t){return a=t},l=function(t){return a&&a.state?a:t&&t.$store||{}},y=function(){function t(o){var e=o.customhook,r=o.name,i=o.destroy,c=o.hit,u=void 0!==c&&c,s=o.watchKey,a=o.onUpdate;n(this,t),this.name=r,this.destroy=i,this.hit=u,this.need=!1,this.initFlag=!1,s&&(this.watchKey=s.replace("$store.state.","")),this.onUpdate=a,this.__customhook=e}return i(t,[{key:"init",value:function(){var t=this;this.initFlag||(this.watchKey&&this.watchAttr((function(o){t[o?"cycleStart":"cycleEnd"]()})),this.initFlag=!0)}},{key:"cycleStart",value:function(){this.hit||(this.hit=!0,this.__customhook&&this.__customhook.triggerHook(this.name))}},{key:"cycleEnd",value:function(){this.hit&&(this.hit=!1,this.__customhook&&this.__customhook.resetExecute(this.name))}},{key:"watchAttr",value:function(t){try{var o=this;l(this.__customhook.pageInstance).watch((function(t){return h(t,o.watchKey)}),(function(e,n){t(o.onUpdate?o.onUpdate(e,n):e)}))}catch(t){}}}]),t}(),p={},d=["created","beforeMount","mounted","activated","deactivated","beforeDestroy","destroyed","onLoad","attached","detached","onShow","onHide","onReady","onUnload"],m=function(t){return o({Launch:new y({customhook:t,name:"onLaunch",destroy:"onUnload",hit:!0}),Created:new y({customhook:t,name:"created",destroy:"destroyed",hit:!0}),Load:new y({customhook:t,name:"onLoad",destroy:"onUnload",hit:"onLoad"==w.initHook}),Attached:new y({customhook:t,name:"attached",destroy:"detached"}),Show:new y({customhook:t,name:"onShow",destroy:"onHide"}),Mounted:new y({customhook:t,name:"mounted",destroy:"destroyed"}),Ready:new y({customhook:t,name:"onReady",destroy:"onUnload"})},Object.keys(p).reduce((function(o,e){var n=p[e];return n.customhook=t,(o[e]=new y(n))&&o}),{}))},k=function(){return Object.keys(p)},b=d.map((function(t){return g(t)})),v=function(){function t(o,e,r){n(this,t),this.pageInstance=o,this.customHooks={},this.customHookArr=[],this.hook={},this.options=e,this.pageHooks=r,this.init()}return i(t,[{key:"init",value:function(){var t=this,o=m(this);this.hook=o;var e=this.pageHooks,n=e.hasOwnProperty("created")||e.hasOwnProperty("onLoad"),r=this.filterHooks(n?e:e.__proto__),i=r.customHookArr,c=r.hookInscape;this.customHookArr=i,i.forEach((function(n){t.customHooks[n]={callback:e[n].bind(t.pageInstance),inscape:c[n],execute:!1},c[n].forEach((function(t){return o[t].need=!0}))})),i.length&&Object.keys(o).forEach((function(t){return o[t].need&&o[t].init()}))}},{key:"filterHooks",value:function(t){var o=this,e={};return{customHookArr:Object.keys(t).filter((function(t){var n=o.getHookArr(t);return!!n.length&&(e[t]=n.filter((function(e){return!!o.hook[e]||(console.warn('[custom-hook 错误声明警告] "'.concat(e,'"钩子未注册，意味着"').concat(t,'"可能永远不会执行，请先注册此钩子再使用，文档：https://github.com/1977474741/vue-custom-hooks#-diyhooks对象说明')),!1)})),t=="on"+n.join("")&&e[t].length==n.length)})),hookInscape:e}}},{key:"triggerHook",value:function(t){var o=this;this.customHookArr.forEach((function(t){var e=o.customHooks[t];e.inscape.every((function(t){return o.hook[t].need&&o.checkHookHit(o.hook[t])}))&&!e.execute&&(o.customHooks[t].callback(o.options),e.execute=!0)}))}},{key:"resetExecute",value:function(t){var o=this;t=g(t),this.customHookArr.forEach((function(e){var n=o.customHooks[e];-1!=n.inscape.indexOf(t)&&(n.execute=!1)}))}},{key:"splitHook",value:function(t){t=t.replace("on","").split(/(?=[A-Z])/);for(var o=u(new Set(b.concat(k()))).sort((function(t,o){return o.length-t.length})),e=[],n="",r=0;r<t.length;r++){n+=t[r],-1!=o.indexOf(n)&&(e.push(n),n="")}return e}},{key:"checkHookHit",value:function(t){if(t.watchKey){var o=h(l(t.__customhook.pageInstance).state,t.watchKey);return t.onUpdate?t.onUpdate(o):o}return t.hit}},{key:"getHookArr",value:function(t){if(-1==t.indexOf("on"))return[];var o=this.splitHook(t),e=k();return o.length>1||-1!=e.indexOf(o[0])?o:[]}}]),t}();function g(t){return t=(t=t.replace("on","")).substring(0,1).toUpperCase()+t.substring(1)}var w,H={h5:{hooksKey:"$options",initHook:"created",supportComponent:!0,isPage:function(t){return t._compiled&&this.supportComponent}},miniprogram:{hooksKey:"$options",initHook:"created",supportComponent:!0,isPage:function(){return this.supportComponent}}};try{wx.version.features&&wx.env,w=H.miniprogram}catch(t){w=H.h5}return{install:function(t,n,r){t.mpvueVersion&&(H.miniprogram.initHook="onLoad"),f(r),p=n,t.mixin(o(o({},d.reduce((function(t,o){return(t[o]=function(t){if(("object"==e(this.customHook)||null==typeof this.customHook)&&this.customHook.customHookArr.length){t&&(this.customHook.options=t);var n=this.customHook.hook;for(var r in n){var i=n[r];i.name==o?i.cycleStart():i.destroy==o&&i.cycleEnd()}}})&&t}),{})),{},c({},w.initHook,(function(t){var o=h(this,w.hooksKey);w.isPage(o)&&(this.customHook=new v(this,t,o))}))))},setHit:function(t,o){m()[t][o?"cycleStart":"cycleEnd"]()}}}));
