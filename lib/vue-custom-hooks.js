!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self)["vue-custom-hooks"]=e()}(this,function(){"use strict";function n(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),o.push.apply(o,n)}return o}function r(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?n(Object(o),!0).forEach(function(t){a(e,t,o[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):n(Object(o)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))})}return e}function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function u(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function c(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function t(t,e,o){return e&&c(t.prototype,e),o&&c(t,o),t}function a(t,e,o){return e in t?Object.defineProperty(t,e,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[e]=o,t}function s(t){return function(t){if(Array.isArray(t))return h(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return h(t,e);var o=Object.prototype.toString.call(t).slice(8,-1);"Object"===o&&t.constructor&&(o=t.constructor.name);if("Map"===o||"Set"===o)return Array.from(t);if("Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return h(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function h(t,e){(null==e||e>t.length)&&(e=t.length);for(var o=0,n=new Array(e);o<e;o++)n[o]=t[o];return n}var f,y=function(t,e){try{return e.split(".").reduce(function(t,e){return t[e]},t)}catch(t){return}},p=function(t){return f&&f.state?f:t&&t.$store||{}},l=function(){function s(t){var e=t.customhook,o=t.name,n=t.destroy,r=t.hit,i=void 0!==r&&r,c=t.watchKey,a=t.onUpdate;u(this,s),this.name=o,this.destroy=n,this.hit=i,this.need=!1,this.initFlag=!1,c&&(this.watchKey=c.replace("$store.state.","")),this.onUpdate=a,this.__customhook=e}return t(s,[{key:"init",value:function(){var e=this;this.initFlag||(this.watchKey&&this.watchAttr(function(t){e[t?"cycleStart":"cycleEnd"]()}),this.initFlag=!0)}},{key:"cycleStart",value:function(){this.hit||(this.hit=!0,this.__customhook&&this.__customhook.triggerHook(this.name))}},{key:"cycleEnd",value:function(){this.hit&&(this.hit=!1,this.__customhook&&this.__customhook.resetExecute(this.name))}},{key:"watchAttr",value:function(o){try{var n=this;p(this.__customhook.pageInstance).watch(function(t){return y(t,n.watchKey)},function(t,e){o(n.onUpdate?n.onUpdate(t,e):t)})}catch(t){}}}]),s}(),d={},m=["created","beforeMount","mounted","activated","deactivated","beforeDestroy","destroyed","onLoad","attached","detached","onShow","onHide","onReady","onUnload"],o=function(n){return r({Launch:new l({customhook:n,name:"onLaunch",destroy:"onUnload",hit:!0}),Created:new l({customhook:n,name:"created",destroy:"destroyed",hit:!0}),Load:new l({customhook:n,name:"onLoad",destroy:"onUnload",hit:"onLoad"==w.initHook}),Attached:new l({customhook:n,name:"attached",destroy:"detached"}),Show:new l({customhook:n,name:"onShow",destroy:"onHide"}),Mounted:new l({customhook:n,name:"mounted",destroy:"destroyed"}),Ready:new l({customhook:n,name:"onReady",destroy:"onUnload"})},Object.keys(d).reduce(function(t,e){var o=d[e];return o.customhook=n,(t[e]=new l(o))&&t},{}))},k=function(){return Object.keys(d)},b=m.map(function(t){return v(t)}),g=function(){function n(t,e,o){u(this,n),this.pageInstance=t,this.hookFun={},this.hooksStr=[],this.hook={},this.options=e,this.pageHooks=o,this.init()}return t(n,[{key:"init",value:function(){var n=this,r=o(this);this.hook=r;var i={};Object.keys(this.pageHooks).filter(function(e){return!!k().some(function(t){return-1!=e.indexOf(t)&&-1==m.indexOf("on"+t)})&&(i[e]=n.splitHook(e),e=="on"+i[e].join("")&&i[e].every(function(t){return r[t]}))}).forEach(function(t,o){n.hooksStr[o]={name:[],execute:!1},n.hookFun[t]=n.pageHooks[t],i[t].forEach(function(t){if(r[t]&&r[t].init)if(n.hooksStr[o].name.push(t),r[t].destroy&&r[t].name){var e=n.pageHooks;e[r[t].name].length&&e[r[t].destroy]&&e[r[t].destroy].length&&(r[t].need=!0)}else r[t].need=!0})}),Object.keys(r).forEach(function(t){return r[t].need&&r[t].init()})}},{key:"triggerHook",value:function(t){var e=this;this.hooksStr.forEach(function(t){t.name.every(function(t){return e.hook[t].need&&e.checkHookHit(e.hook[t])})&&!t.execute&&(e.hookFun["on"+t.name.join("")].call(e.pageInstance,e.options),t.execute=!0)})}},{key:"resetExecute",value:function(e){e=v(e),this.hooksStr.forEach(function(t){-1!=t.name.indexOf(e)&&(t.execute=!1)})}},{key:"splitHook",value:function(t){t=t.replace("on","").split(/(?=[A-Z])/);for(var e=s(new Set(b.concat(k()))).sort(function(t,e){return e.length-t.length}),o=[],n="",r=0;r<t.length;r++){n+=t[r],-1!=e.indexOf(n)&&(o.push(n),n="")}return o}},{key:"checkHookHit",value:function(t){if(t.watchKey){var e=y(p(t.__customhook.pageInstance).state,t.watchKey);return t.onUpdate?t.onUpdate(e):e}return t.hit}}]),n}();function v(t){return t=(t=t.replace("on","")).substring(0,1).toUpperCase()+t.substring(1)}var e={h5:{hooksKey:"$options.__proto__",mainHooksKey:"$options",initHook:"created",supportComponent:!0,isPage:function(t,e){return t._compiled&&(this.supportComponent||"page"==e||"app"==e)}},wx:{hooksKey:"$options",mainHooksKey:"$options",initHook:"created",supportComponent:!0,isPage:function(t,e){return this.supportComponent||"page"==e||"app"==e}}};try{uni.x}catch(t){e.wx.initHook="onLoad"}var w=e[document?"h5":"wx"];return{install:function(t,e,o){f=o,d=e,t.mixin(r(r({},m.reduce(function(t,r){return t[r]=function(t){if("object"==i(this.customHook)||null==typeof this.customHook){t&&(this.customHook.options=t);var e=this.customHook.hook;for(var o in e){var n=e[o];n.name==r?n.cycleStart():n.destroy==r&&n.cycleEnd()}}},t},{})),{},a({},w.initHook,function(t){var e=y(this,w["app"==this.$options.mpType?"mainHooksKey":"hooksKey"]),o=this.$mp&&this.$mp.mpType||e.mpType;w.isPage(e,o)&&(this.customHook=new g(this,t,e))})))},setHit:function(t,e){o()[t][e?"cycleStart":"cycleEnd"]()}}});
